%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[a4paper,11pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
\edef\sphinxdqmaybe{\ifdefined\DeclareUnicodeCharacterAsOptional\string"\fi}
  \DeclareUnicodeCharacter{\sphinxdqmaybe00A0}{\nobreakspace}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2500}{\sphinxunichar{2500}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2502}{\sphinxunichar{2502}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2514}{\sphinxunichar{2514}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe251C}{\sphinxunichar{251C}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}
\usepackage{times}
\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}

% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}
\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\addto\captionsenglish{\renewcommand{\figurename}{Fig.}}
\addto\captionsenglish{\renewcommand{\tablename}{Table}}
\addto\captionsenglish{\renewcommand{\literalblockname}{Listing}}

\addto\captionsenglish{\renewcommand{\literalblockcontinuedname}{continued from previous page}}
\addto\captionsenglish{\renewcommand{\literalblockcontinuesname}{continues on next page}}
\addto\captionsenglish{\renewcommand{\sphinxnonalphabeticalgroupname}{Non-alphabetical}}
\addto\captionsenglish{\renewcommand{\sphinxsymbolsname}{Symbols}}
\addto\captionsenglish{\renewcommand{\sphinxnumbersname}{Numbers}}

\addto\extrasenglish{\def\pageautorefname{page}}

\setcounter{tocdepth}{1}



\title{Tutorial on BayesVP Documentation}
\date{Jul 04, 2019}
\release{0.0.0.1}
\author{Tanvir Hussain}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\pagestyle{empty}
\maketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{tutorial::doc}}



\chapter{\sphinxstyleliteralintitle{\sphinxupquote{bayesvp}}: Tutorial}
\label{\detokenize{tutorial:bayesvp-tutorial}}
\sphinxcode{\sphinxupquote{bayesvp}} is a Bayesian MCMC parallel Voigt profile fitting routine
written by \sphinxhref{mailto:jwliang@oddjob.uchicago.edu}{Cameron Liang} \& Andrey Kravtsov.

\sphinxcode{\sphinxupquote{bayesvp}} provides a number of helpful executable scripts that work
with command line arguments (saved in your environment \sphinxcode{\sphinxupquote{PATH}}). The
main functionality is the MCMC Voigt profile fitting (bvpfit) where the
user supplies a config file that specifies parameters for the fitting.
These include parameter priors, number of walkers, parallel threads,
line spread function, continuum model, Bayesian model comparisons, and
etc. There are utility functions that allow users to quickly create an
example config file, process and plot the chains, process and plot the
best fit models and more. For details on the code, refer to the papers
\sphinxhref{https://arxiv.org/abs/1710.09852}{Liang \& Kravtsov 2017} and \sphinxhref{https://arxiv.org/abs/1710.00411}{Liang
et al. 2017}.

The following is a short tutorial on how to use \sphinxcode{\sphinxupquote{bayesvp}} fitting
routine.


\section{Installation}
\label{\detokenize{tutorial:installation}}
Install \sphinxcode{\sphinxupquote{bayesvp}} using pip with the \sphinxcode{\sphinxupquote{-{-}user}} flag:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pip} \PYG{n}{install} \PYG{n}{bayesvp} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{user}
\end{sphinxVerbatim}

\sphinxstyleemphasis{For users with Python 3 and above, you need to convert all the
{}`{}`bayesvp{}`{}` scripts (written originally in Python 2.7) to Python 3 using
the Python package {}`2to3 \textless{}https://pypi.org/project/2to3/\textgreater{}{}`\_.}

After installing \sphinxcode{\sphinxupquote{bayesvp}} we should run its unit tests to ensure the
package works as expected. The simplest way to do this is inside a
python shell:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{bayesvp}\PYG{n+nn}{.}\PYG{n+nn}{tests} \PYG{k}{import} \PYG{n}{run\PYGZus{}tests}
\end{sphinxVerbatim}

The output should look something like this:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{The} \PYG{n}{output} \PYG{n}{should} \PYG{n}{look} \PYG{n}{something} \PYG{n}{like} \PYG{n}{this}\PYG{p}{:}

\PYG{n}{test\PYGZus{}config\PYGZus{}file\PYGZus{}exists} \PYG{p}{(}\PYG{n}{bayesvp}\PYG{o}{.}\PYG{n}{tests}\PYG{o}{.}\PYG{n}{test\PYGZus{}config}\PYG{o}{.}\PYG{n}{TCConfigFile}\PYG{p}{)} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.} \PYG{n}{ok}
\PYG{n}{test\PYGZus{}default\PYGZus{}no\PYGZus{}continuum\PYGZus{}params} \PYG{p}{(}\PYG{n}{bayesvp}\PYG{o}{.}\PYG{n}{tests}\PYG{o}{.}\PYG{n}{test\PYGZus{}config}\PYG{o}{.}\PYG{n}{TCConfigFile}\PYG{p}{)} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.} \PYG{n}{ok}
\PYG{n}{test\PYGZus{}example\PYGZus{}mcmc\PYGZus{}params} \PYG{p}{(}\PYG{n}{bayesvp}\PYG{o}{.}\PYG{n}{tests}\PYG{o}{.}\PYG{n}{test\PYGZus{}config}\PYG{o}{.}\PYG{n}{TCConfigFile}\PYG{p}{)} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.} \PYG{n}{ok}
\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}
\PYG{n}{test\PYGZus{}prior} \PYG{p}{(}\PYG{n}{bayesvp}\PYG{o}{.}\PYG{n}{tests}\PYG{o}{.}\PYG{n}{test\PYGZus{}likelihood}\PYG{o}{.}\PYG{n}{TCPosterior}\PYG{p}{)} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.} \PYG{n}{ok}
\PYG{n}{test\PYGZus{}general\PYGZus{}intensity} \PYG{p}{(}\PYG{n}{bayesvp}\PYG{o}{.}\PYG{n}{tests}\PYG{o}{.}\PYG{n}{test\PYGZus{}model}\PYG{o}{.}\PYG{n}{TCSingleVP}\PYG{p}{)} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.} \PYG{n}{ok}
\PYG{n}{test\PYGZus{}simple\PYGZus{}spec} \PYG{p}{(}\PYG{n}{bayesvp}\PYG{o}{.}\PYG{n}{tests}\PYG{o}{.}\PYG{n}{test\PYGZus{}model}\PYG{o}{.}\PYG{n}{TCSingleVP}\PYG{p}{)} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.} \PYG{n}{ok}

\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}
\PYG{n}{Ran} \PYG{l+m+mi}{13} \PYG{n}{tests} \PYG{o+ow}{in} \PYG{l+m+mf}{3.654}\PYG{n}{s}

\PYG{n}{OK}
\end{sphinxVerbatim}

This would ensure \sphinxcode{\sphinxupquote{bayesvp}} package is installed.


\section{Fit a simple absorption line with \sphinxstyleliteralintitle{\sphinxupquote{bayesvp}}}
\label{\detokenize{tutorial:fit-a-simple-absorption-line-with-bayesvp}}
We describe a simple tutorial on how to use \sphinxcode{\sphinxupquote{bayesvp}} package. It can
be run in an interactive python session or using a python script.

To start \sphinxcode{\sphinxupquote{bayesvp}}, first we need to setup a configuration file.
\sphinxcode{\sphinxupquote{bayesvp}} is meant to run with this file in background as it can take
few minutes for MCMC sampling depending on the chosen number of walkers,
steps, and parallel processes.

Below we illustrate a simple interactive use of the code and setting up
of a configuration file to fit an O VI transition with rest wavelength
of 1031.926 Å.


\subsection{Setup a ‘config file’}
\label{\detokenize{tutorial:setup-a-config-file}}
First step is to import \sphinxcode{\sphinxupquote{bayesvp}} package. Next we import an object,
\sphinxcode{\sphinxupquote{bvp\_write\_config}}, that interactively asks the user a few questions
to create a config file.

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{In} \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:} \PYG{k+kn}{import} \PYG{n+nn}{bayesvp}

\PYG{n}{In} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{:} \PYG{k+kn}{from} \PYG{n+nn}{bayesvp}\PYG{n+nn}{.}\PYG{n+nn}{scripts} \PYG{k}{import} \PYG{n}{bvp\PYGZus{}write\PYGZus{}config} \PYG{k}{as} \PYG{n}{wc}
\end{sphinxVerbatim}

Let us assume that the spectrum in question is located in the following
directory:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{In} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{:} \PYG{n}{spectrum\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/home/\PYGZlt{}username\PYGZgt{}/bayesvp\PYGZus{}tutorial/codes/examples/}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}

Suppose the file name of the example spectrum is \sphinxcode{\sphinxupquote{OVI.spec}} with three
of columns of data: wave, flux, error. We can use the
\sphinxcode{\sphinxupquote{bvp\_write\_config}} routine to set up the config file as:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{In} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{:} \PYG{n}{config\PYGZus{}writer} \PYG{o}{=} \PYG{n}{wc}\PYG{o}{.}\PYG{n}{WriteBayesVPConfig}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{print\PYGZus{}to\PYGZus{}file}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}i}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

On executing the above command, the routine will ask the user few
questions:

\sphinxstyleemphasis{The questions are on the left, while on the right, as an example, the
answers are written. These answers can change based on different user
preferences.}

\sphinxcode{\sphinxupquote{Path to spectrum:}} /home/\textless{}username\textgreater{}/bayesvp\_tutorial/codes/examples

\sphinxcode{\sphinxupquote{Spectrum filename:}} OVI.spec

\sphinxcode{\sphinxupquote{filename for output chain:}} o6

\sphinxstyleemphasis{Enter the name of the ion to be fitted: first atom name, next its
ionization state}

\sphinxcode{\sphinxupquote{atom:}} O

\sphinxcode{\sphinxupquote{state:}} VI

\sphinxstyleemphasis{Enter the number of components to used in the fitting routine. If you
wish to use more components then type in the number}

\sphinxcode{\sphinxupquote{Maximum number of components to try:}} 1

\sphinxstyleemphasis{Enter the observed wavelength region to be used in the fitting routine}

\sphinxcode{\sphinxupquote{Starting wavelength(A):}} 1030

\sphinxcode{\sphinxupquote{Ending wavelength(A):}} 1033

\sphinxcode{\sphinxupquote{Enter the priors:}}

\sphinxstyleemphasis{Enter the assumed minimum and maximum values of column density for the
absorption feature to be fitted}

\sphinxcode{\sphinxupquote{min logN {[}cm\textasciicircum{}-2{]} =}} 10

\sphinxcode{\sphinxupquote{max logN {[}cmˆ-2{]} =}} 18

\sphinxstyleemphasis{Similarly, enter the assumed minimum and maximum values of Doppler b
parameter for the absorption feature to be fitted}

\sphinxcode{\sphinxupquote{min b {[}km/s{]} =}} 0

\sphinxcode{\sphinxupquote{max b {[}km/s{]} =}} 100

\sphinxstyleemphasis{Enter the central redshift of the absorption feature corresponding to
the ion to be fitted}

\sphinxcode{\sphinxupquote{central redshift =}} 0

\sphinxcode{\sphinxupquote{velocity range {[}km/s{]} =}}300

\sphinxstyleemphasis{Here we enter parameters to be used for MCMC sampling}

\sphinxcode{\sphinxupquote{Enter the MCMC parameters:}}

\sphinxcode{\sphinxupquote{Number of walkers:}} 400

\sphinxcode{\sphinxupquote{Number of steps:}} 2000

\sphinxcode{\sphinxupquote{Number of processes:}} 8

\sphinxcode{\sphinxupquote{Model selection method bic(default),aic,bf:}} bic

\sphinxcode{\sphinxupquote{MCMC sampler kombine(default), emcee:}} kombine

\sphinxstyleemphasis{On completion of the above step, the configuration file is automatically
written within a sub-directory where the spectrum is located.}

\sphinxcode{\sphinxupquote{Written config file:}}
/home/\textless{}username\textgreater{}/bayesvp\_tutorial/codes/examples/bvp\_configs/config\_OVI.dat

The saved configuration file ‘config\_OVI.dat’ will look like the
following:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{spec\PYGZus{}path} \PYG{o}{/}\PYG{n}{home}\PYG{o}{/}\PYG{o}{\PYGZlt{}}\PYG{n}{username}\PYG{o}{\PYGZgt{}}\PYG{o}{/}\PYG{n}{bayesvp\PYGZus{}tutorial}\PYG{o}{/}\PYG{n}{codes}\PYG{o}{/}\PYG{n}{examples}
\PYG{n}{output} \PYG{n}{o6}
\PYG{n}{mcmc} \PYG{l+m+mi}{400} \PYG{l+m+mi}{2000} \PYG{l+m+mi}{8} \PYG{n}{bic} \PYG{n}{kombine}
\PYG{o}{\PYGZpc{}}\PYG{o}{\PYGZpc{}} \PYG{n}{OVI}\PYG{o}{.}\PYG{n}{spec} \PYG{l+m+mf}{1030.000000} \PYG{l+m+mf}{1033.000000}
\PYG{o}{\PYGZpc{}} \PYG{n}{O} \PYG{n}{VI} \PYG{l+m+mi}{15} \PYG{l+m+mi}{30} \PYG{l+m+mf}{0.000000}
\PYG{n}{logN} \PYG{l+m+mf}{10.00} \PYG{l+m+mf}{18.00}
\PYG{n}{b}    \PYG{l+m+mf}{0.00} \PYG{l+m+mf}{100.00}
\PYG{n}{z}    \PYG{l+m+mf}{0.000000} \PYG{l+m+mf}{300.00}
\end{sphinxVerbatim}

To deal with HST/COS data, which requires incorporation of line-spread-functions (LSFs), the above saved \sphinxstylestrong{config\_OVI.dat} needs to be modified as such:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{spec\PYGZus{}path} \PYG{o}{/}\PYG{n}{home}\PYG{o}{/}\PYG{o}{\PYGZlt{}}\PYG{n}{username}\PYG{o}{\PYGZgt{}}\PYG{o}{/}\PYG{n}{bayesvp\PYGZus{}tutorial}\PYG{o}{/}\PYG{n}{codes}\PYG{o}{/}\PYG{n}{examples}
\PYG{n}{output} \PYG{n}{o6}
\PYG{n}{mcmc} \PYG{l+m+mi}{400} \PYG{l+m+mi}{2000} \PYG{l+m+mi}{8} \PYG{n}{bic} \PYG{n}{kombine}
\PYG{o}{\PYGZpc{}}\PYG{o}{\PYGZpc{}} \PYG{n}{OVI}\PYG{o}{.}\PYG{n}{spec} \PYG{l+m+mf}{1030.000000} \PYG{l+m+mf}{1033.000000}
\PYG{o}{\PYGZpc{}} \PYG{n}{O} \PYG{n}{VI} \PYG{l+m+mi}{15} \PYG{l+m+mi}{30} \PYG{l+m+mf}{0.000000}
\PYG{n}{lsf} \PYG{n}{COS\PYGZus{}res}\PYG{o}{\PYGZlt{}}\PYG{n}{central\PYGZus{}wavel}\PYG{o}{\PYGZgt{}}\PYG{o}{.}\PYG{n}{dat}
\PYG{n}{logN} \PYG{l+m+mf}{10.00} \PYG{l+m+mf}{18.00}
\PYG{n}{b}    \PYG{l+m+mf}{0.00} \PYG{l+m+mf}{100.00}
\PYG{n}{z}    \PYG{l+m+mf}{0.000000} \PYG{l+m+mf}{300.00}
\end{sphinxVerbatim}

\sphinxstyleemphasis{Note the changes made above. An additional statement:
lsf \textless{}LSF kernel at the central wavelength\textgreater{} is added.}

The \sphinxhref{http://www.stsci.edu/hst/instrumentation/cos/performance/spectral-resolution}{HST/COS LSFs} should be saved in a sub-directory (named \sphinxstylestrong{database}) where the spectrum is located.


\subsection{Run a MCMC fit}
\label{\detokenize{tutorial:run-a-mcmc-fit}}
To start MCMC fit, firstly we need to import three more objects:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{In} \PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{:} \PYG{k+kn}{from} \PYG{n+nn}{bayesvp}\PYG{n+nn}{.}\PYG{n+nn}{config} \PYG{k}{import} \PYG{n}{DefineParams}

\PYG{n}{In} \PYG{p}{[}\PYG{l+m+mi}{6}\PYG{p}{]}\PYG{p}{:} \PYG{k+kn}{from} \PYG{n+nn}{bayesvp}\PYG{n+nn}{.}\PYG{n+nn}{mcmc\PYGZus{}setup} \PYG{k}{import} \PYG{n}{bvp\PYGZus{}mcmc\PYGZus{}single} \PYG{k}{as} \PYG{n}{mc\PYGZus{}single}

\PYG{n}{In} \PYG{p}{[}\PYG{l+m+mi}{7}\PYG{p}{]}\PYG{p}{:} \PYG{k+kn}{from} \PYG{n+nn}{bayesvp}\PYG{n+nn}{.}\PYG{n+nn}{mcmc\PYGZus{}setup} \PYG{k}{import} \PYG{n}{bvp\PYGZus{}mcmc} \PYG{k}{as} \PYG{n}{mcmc}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{bayesvp}} can be run by supplying the full path to the config file as
a command line argument. \sphinxcode{\sphinxupquote{bayesvp}} will print to screen the relevant
information from the config file



\renewcommand{\indexname}{Index}
\printindex
\end{document}